# win32 模态窗口

win32 创建模态窗口
https://www.cnblogs.com/zplutor/archive/2011/02/20/1958973.html


通过查阅MSDN，可以知道DialogBox实际上是一个宏，它调用DialogBoxParam函数来创建对话框。而后者通过CreateWindowEx函数创建窗口，然后disables父窗口，并开启一个新的消息循环来处理对话框的消息。我们可以自己实现这个过程。

重点：

```c
//禁用父窗口
EnableWindow(hParent, FALSE);

//收尾
EnableWindow(hParent, TRUE);
SetForegroundWindow(hParent);
```

上面的代码看上去几乎就是一个新的Windows应用程序，不同的地方在于，函数的开头和结尾增加了对EnableWindow和SetForegroundWindow的调用。如果没有对SetForegroundWindow的调用，在关闭模态窗口之后父窗口会最小化。

 
运行程序，点击菜单上的Dialog项，就可以弹出一个模态窗口，点击父窗口任意位置，模态窗口会闪烁，就像模态对话框的行为一样。现在，可以修改模态窗口的样式，并处理WM_CREATE消息在窗口中增加内容了。



（Win32）如何手动实现模态对话框 —— 你应该知道的父子窗口与拥有者与被拥有者窗口之间的关系
https://blog.twofei.com/580/

如何以正确的顺序禁用与使能窗口(回归激活窗口）（Win32）

https://blog.twofei.com/581/


## 原理

如果两个窗口a和b， a拥有b,然后禁用了a后， 点击a后，b就闪烁
b就成了a的模态窗体

## 核心概念 父窗口、拥有者窗口
https://www.cnblogs.com/2018shawn/p/12366097.html



## 注意
64位环境下，没有
```
SetWindowLongA(data->hwnd,
    GWL_HWNDPARENT,
    (LONG)(targetData->hwnd));
```
要改为
```
SetWindowLongPtrA(data->hwnd,
    GWLP_HWNDPARENT,
    (LONG_PTR)(targetData->hwnd));
```