# win32 窗口相关

## 基本概念

* HANDLE
> 句柄，或者说是对象的id, 可以认为是对指针的进一步封装

* HINSTANCE
> 程序实例的handle

* WNDCLASS
> 窗口的预定义的属性,可以认为是模板属性,通过模板可以创建类似的多个窗口,
> 需要注意A/W的区别。 会影响到事件处理中，char消息的字符编码格式是DBCS还是unicode. dbcs指双字节编码，可以通过ActivePage取得当前的编码格式再转为utf8

* HWND 
> 窗口的handle, Win32中对窗口内部的组件也是统一抽象为HWND的,所以用GetClientRect(hwnd, RECT*)就可以拿到获取内部组件的矩形区



## 基本流程

### 创建窗口
* RegisterClassA 注册窗口类,配置消息处理函数
* CreateWindowExA 创建窗口


### 创建窗口Style属性

* WS_EX_TOPMOST 让窗口总是在最前

### 启用opengl

* ChoosePixelFormat 
> 这一步比较耗时，推荐把format保存起来，供后续创建新窗口时使用

* SetPixelFormat

* wglCreateContext
* wglMakeCurrent 
* glewInit/gladInit... 初始化opengl新版本函数集合


## 窗口操作

* 显示窗口 ShowWindow(hwnd, SW_SHOW)
* 隐藏窗口 ShowWindow(hwnd, SW_HIDE)
* 最大化窗口 ShowWindow(hwnd, SW_MAXIMIZE)
* 最小化窗口 ShowWindow(hwnd, SW_MINIMIZE)
* 还原窗口 ShowWindow(hwnd, SW_NORMAL)
* 关闭窗口 DestroyWindow(hwnd)
* 设置标题 SetWindowTextW(hwnd, wchar_t*)
* 获取标题 wchar_t* GetWindowTextW(hwnd)
* 取得当前激活的窗口 HWND GetActiveWindow()
* 移动窗口、重设置窗口大小 MoveWindow()
* 设置窗口显示在最前面 SetForegroundWindow()

### 窗口几何

* 获取窗口在屏幕的矩形区域 GetWindowRect(hwnd, RECT*) 

> 问题在于这个坐标是不是含 非客户区的？即是不是含边框标题栏的？
> 对于窗体（不是内部的控件）, GetWindowRect取到的left/top是含边框和标题栏的
> 所以像获取客户区的屏幕坐标，可以使用ClientToScreen(hwnd, &POINT{0})

* 获取相对于窗口左上角的矩形区域 GetClientRect(hwnd, RECT*)
* 设置窗口位置 SetWindowPos(hwnd, null, x, y, w, h, 0)
* 客户区坐标转屏幕坐标/获取客户区的屏幕坐标 ClientToScreen
* 屏幕坐标转客户区 ScreenToClient


## 透明窗口

有几种实现， 如LayeredWindow, 如DWM


## 消息处理


### 消息类型

* WM_SETFOCUS 获取焦点事件
* WM_KILLFOCUS 失去焦点事件


## 绘制

### opengl 绘制

* 可以在WM_PAINT事件或者单独线程中或者事件循环中绘制
* wglMakeCurrent 指定opengl环境
* glViewport()
* glClear()
* 绘制代码
* SwapBuffers(GetDC(hwnd))